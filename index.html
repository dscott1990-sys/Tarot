<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mystic Tarot</title>
    <style>
        :root { --gold: #c5a059; --blue: #0f0c29; --text: #f5f5f5; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--blue); color: var(--text); font-family: serif; margin: 0; padding: 15px; text-align: center; min-height: 100vh; }
        #moon { color: var(--gold); border: 1px solid var(--gold); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; display: inline-block; margin-bottom: 15px; }
        .btn-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .action-btn { background: var(--gold); color: var(--blue); border: none; padding: 12px; border-radius: 25px; font-weight: bold; text-transform: uppercase; font-size: 0.75rem; min-width: 100px; cursor: pointer; }
        #search { width: 100%; padding: 12px; border-radius: 25px; border: 1px solid var(--gold); background: rgba(255,255,255,0.1); color: white; margin-bottom: 20px; outline: none; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
        .tarot-card { background: rgba(0,0,0,0.3); border: 1px solid var(--gold); border-radius: 8px; padding: 5px; }
        .tarot-card img { width: 100%; border-radius: 5px; display: block; min-height: 150px; background: #111; }
        .rev { transform: rotate(180deg); }
        .summary-box { grid-column: 1 / -1; background: rgba(255,255,255,0.05); border: 1px solid var(--gold); padding: 20px; border-radius: 15px; margin-top: 25px; text-align: left; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); overflow-y: auto; }
        .modal-content { background: var(--blue); margin: 15% auto; padding: 20px; border: 1px solid var(--gold); width: 90%; max-width: 400px; border-radius: 15px; position: relative; }
    </style>
</head>
<body>

<div id="moon">âœ¨ Lunar Energy Loading...</div>
<h1>MYSTIC READER</h1>

<div class="btn-container">
    <button class="action-btn" onclick="draw(1)">Daily</button>
    <button class="action-btn" onclick="draw(3)">3-Card</button>
    <button class="action-btn" onclick="draw(5)">5-Card</button>
</div>

<input type="text" id="search" placeholder="Search cards..." onkeyup="filter()">
<div class="card-grid" id="grid"></div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span style="float:right; cursor:pointer; color:var(--gold); font-size:24px;" onclick="closeM()">&times;</span>
        <img id="mImg" src="" style="width:120px; border-radius:5px; border:1px solid var(--gold);">
        <h2 id="mTitle" style="color:var(--gold); margin:10px 0;"></h2>
        <p id="mDesc" style="font-style:italic;"></p>
    </div>
</div>

<script>
// ERROR PROTECTION: We wrap everything in a "Try" block
try {
    const cards = [
        { n: "The Fool", img: "https://upload.wikimedia.org/wikipedia/commons/9/90/RWS_Tarot_00_Fool.jpg", g: "New beginnings.", r: "Recklessness." },
        { n: "The Magician", img: "https://upload.wikimedia.org/wikipedia/commons/d/de/RWS_Tarot_01_Magician.jpg", g: "Manifestation.", r: "Manipulation." },
        { n: "The High Priestess", img: "https://upload.wikimedia.org/wikipedia/commons/8/88/RWS_Tarot_02_High_Priestess.jpg", g: "Intuition.", r: "Secrets." },
        { n: "The Empress", img: "https://upload.wikimedia.org/wikipedia/commons/a/af/RWS_Tarot_03_Empress.jpg", g: "Abundance.", r: "Blocks." },
        { n: "The Emperor", img: "https://upload.wikimedia.org/wikipedia/commons/c/c3/RWS_Tarot_04_Emperor.jpg", g: "Structure.", r: "Rigid." },
        { n: "The Hierophant", img: "https://upload.wikimedia.org/wikipedia/commons/8/8d/RWS_Tarot_05_Hierophant.jpg", g: "Tradition.", r: "Rebel." },
        { n: "The Lovers", img: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_06_Lovers.jpg", g: "Choices.", r: "Imbalance." },
        { n: "The Chariot", img: "https://upload.wikimedia.org/wikipedia/commons/9/9b/RWS_Tarot_07_Chariot.jpg", g: "Victory.", r: "No control." },
        { n: "Strength", img: "https://upload.wikimedia.org/wikipedia/commons/f/f5/RWS_Tarot_08_Strength.jpg", g: "Courage.", r: "Self-doubt." },
        { n: "The Hermit", img: "https://upload.wikimedia.org/wikipedia/commons/4/4d/RWS_Tarot_09_Hermit.jpg", g: "Solitude.", r: "Isolation." },
        { n: "Wheel of Fortune", img: "https://upload.wikimedia.org/wikipedia/commons/3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg", g: "Fate.", r: "Bad luck." },
        { n: "Justice", img: "https://upload.wikimedia.org/wikipedia/commons/e/e0/RWS_Tarot_11_Justice.jpg", g: "Truth.", r: "Unfair." },
        { n: "The Hanged Man", img: "https://upload.wikimedia.org/wikipedia/commons/2/2b/RWS_Tarot_12_Hanged_Man.jpg", g: "Perspective.", r: "Stall." },
        { n: "Death", img: "https://upload.wikimedia.org/wikipedia/commons/d/d7/RWS_Tarot_13_Death.jpg", g: "Transition.", r: "Resistance." },
        { n: "Temperance", img: "https://upload.wikimedia.org/wikipedia/commons/f/f8/RWS_Tarot_14_Temperance.jpg", g: "Balance.", r: "Excess." },
        { n: "The Devil", img: "https://upload.wikimedia.org/wikipedia/commons/5/55/RWS_Tarot_15_Devil.jpg", g: "Shadow.", r: "Release." },
        { n: "The Tower", img: "https://upload.wikimedia.org/wikipedia/commons/5/53/RWS_Tarot_16_Tower.jpg", g: "Upheaval.", r: "Pride." },
        { n: "The Star", img: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_17_Star.jpg", g: "Hope.", r: "Despair." },
        { n: "The Moon", img: "https://upload.wikimedia.org/wikipedia/commons/7/7f/RWS_Tarot_18_Moon.jpg", g: "Illusion.", r: "Clarity." },
        { n: "The Sun", img: "https://upload.wikimedia.org/wikipedia/commons/1/17/RWS_Tarot_19_Sun.jpg", g: "Joy.", r: "Sadness." },
        { n: "Judgement", img: "https://upload.wikimedia.org/wikipedia/commons/d/dd/RWS_Tarot_20_Judgement.jpg", g: "Rebirth.", r: "Doubt." },
        { n: "The World", img: "https://upload.wikimedia.org/wikipedia/commons/f/ff/RWS_Tarot_21_World.jpg", g: "Completion.", r: "Delays." }
    ];

    function updateMoon() {
        const d = new Date().getDate();
        const phases = ["ðŸŒ‘ New Moon", "ðŸŒ’ Waxing", "ðŸŒ“ First Quarter", "ðŸŒ” Gibbous", "ðŸŒ• Full Moon", "ðŸŒ– Waning", "ðŸŒ— Last Quarter", "ðŸŒ˜ Crescent"];
        document.getElementById('moon').innerText = phases[d % 8];
    }

    function render(list) {
        const grid = document.getElementById('grid');
        grid.innerHTML = list.map(c => `
            <div class="tarot-card" onclick="openM('${c.n.replace(/'/g, "\\'")}')">
                <img src="${c.img}">
                <h3 style="font-size:0.7rem; margin:5px 0;">${c.n}</h3>
            </div>
        `).join('');
    }

    window.openM = function(name, rev = false) {
        const card = cards.find(c => c.n === name);
        document.getElementById('mImg').src = card.img;
        document.getElementById('mImg').className = rev ? 'rev' : '';
        document.getElementById('mTitle').innerText = name + (rev ? " (Rev)" : "");
        document.getElementById('mDesc').innerText = rev ? card.r : card.g;
        document.getElementById('modal').style.display = 'block';
    }

    window.closeM = function() { document.getElementById('modal').style.display = 'none'; }

    window.draw = function(num) {
        const shuffled = [...cards].sort(() => 0.5 - Math.random());
        const picked = shuffled.slice(0, num);
        const grid = document.getElementById('grid');
        grid.innerHTML = `<div style="grid-column:1/-1;"><button class="action-btn" onclick="location.reload()">Reset Deck</button></div>`;
        
        let insight = "";
        picked.forEach((c, i) => {
            const isR = Math.random() > 0.7;
            insight += `<div style="margin-bottom:10px;"><strong>Card ${i+1}: ${c.n}</strong><br>${isR ? c.r : c.g}</div>`;
            grid.innerHTML += `
                <div class="tarot-card" onclick="openM('${c.n.replace(/'/g, "\\'")}', ${isR})">
                    <img src="${c.img}" class="${isR ? 'rev' : ''}">
                    <h3>${c.n}</h3>
                </div>`;
        });
        grid.innerHTML += `<div class="summary-box"><h3>Oracle Insight</h3>${insight}</div>`;
    }

    window.filter = function() {
        const q = document.getElementById('search').value.toLowerCase();
        render(cards.filter(c => c.n.toLowerCase().includes(q)));
    }

    // Initialize
    updateMoon();
    render(cards);

} catch (e) {
    document.body.innerHTML = "<h1>Error loading deck. Please refresh.</h1><p>" + e + "</p>";
}
</script>
</body>
</html>
